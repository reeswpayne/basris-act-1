<!DOCTYPE html>
<!--
since you're here anyway: there's a small easter egg on the text commands page but it's probably not worth finding, sorry
you may notice this page's code is garbage: i'm not a web designer! ;-;
it's w3c valid, at least
-->

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>CYK Documentation - Projectile management</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/themesidebar.css" rel="stylesheet">
    <link href="../css/shThemeRDark.css" rel="stylesheet">

    <!-- Syntax highlighting -->
    <script type="text/javascript" src="../js/shCore.js"></script>
    <script type="text/javascript" src="../js/shBrushLua.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<img src="../img/bg2.png" alt="Undertale background" class="backimg">
<div class="container arena black">
    <div class="col-md-2">
        <!--navigation-->
        <nav class="nav-sidebar">
            <ul class="nav tabs">
                <li class="li-header">Basics</li>
                    <li><a href="../documentation.html">Welcome</a></li>
                    <li><a href="howtoread.html">How to read this documentation</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li><a href="controls.html">Controls</a></li>
                    <li><a href="basic.html">Basic setup</a></li>
                    <li><a href="variables.html">Special Variables</a></li>
                    <li><a href="terms.html">Terminology</a></li>
                <li class="li-header">API</li>
                    <li><a href="api-text.html">Text commands</a></li>
                    <li><a href="api-events.html">Game events</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent">Functions &amp; Objects:</li>
                        <li class="li-indent"><a href="api-functions-main.html">Misc. Functions</a></li>
                        <li class="li-indent"><a href="api-functions-player.html">The Player Object</a></li>
                        <li class="li-indent"><a href="api-functions-entity.html"><span class="CYK"></span> The Entity Object</a></li>
                        <li class="li-indent"><a href="api-functions-script.html">The Script Object</a></li>
                        <li class="li-indent"><a href="api-functions-audio.html">The Audio Object</a></li>
                        <li class="li-indent"><a href="api-functions-newaudio.html"><span class="CYF"></span> The NewAudio Object</a></li>
                        <li class="li-indent"><a href="api-functions-input.html">The Input Object</a></li>
						<li class="li-indent"><a href="api-functions-time.html">The Time Object</a></li>
                        <li class="li-indent"><a href="api-functions-misc.html"><span class="CYF"></span>The Misc Object</a></li>
                        <li class="li-indent"><a href="api-functions-waves.html">Wave Scripts</a></li>
                        <li class="li-indent"><a href="cyf-inventory.html"><span class="CYF"></span> The Inventory Object</a></li>
                        <li class="li-indent"><a href="cyf-text.html"><span class="CYF"></span> The Text Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="active" style="margin-left:5px;">> Projectile management <</li>
                    <li><a href="api-animation.html">Sprites &amp; Animation</a></li>
                    <li><a href="cyf-ppcollision.html"><span class="CYF"></span> The Pixel-Perfect Collision System</a></li>
                    <li><a href="api-keys.html"><span class="CYF"></span> Key List</a></li>
                <li class="li-header">Resources</li>
                    <li><a href="../media/dialogoptions.png">Dialog bubble names</a></li>
            </ul>
        </nav>
    </div>
    <!--tabs'n'shit-->
    <div class="tab-content col-md-10">
        <div class="tab-pane active text-style" id="api-projectile">
            <h2>Projectile management</h2><br><br>
            <p>
                Projectile management is, starting from 0.2.0, available from both the encounter and the wave scripts. As
                a result it is now in its own section.
            </p><br>

            <p>
                <span class="function">CreateProjectile(<span class="string"></span> spritename, <span class="number"></span>
                initial_x, <span class="number"></span> initial_y,<span class="CYF"></span> <span class="string"></span>
                layer = "") returns <span class="userdata">bullet</span> [E/M/P/W]</span>
                Creates a bullet that you can store and modify, with its spawn position relative to the center of the arena.
                The hitbox of the bullet is a rectangle around the sprite, unless you use CYF's PP mode.<br>
                <span class="CYF"></span> You can specify a layer if you want - otherwise, the bullet will be in the normal
                bullet layer.
                <br><br>
                <h4><span class="CYK"></span> Important!</h4>
                While bullets can be created in the Encounter, Monster and Player scripts, <font color="#fff"><u>it is not
                recommended to do so. Things may break.</u></font> Try to use Sprite objects instead.
            </p><br>

            <p>
                <span class="function">CreateProjectileAbs(<span class="string"></span> spritename, <span class="number"></span>
                initial_x, <span class="number"></span> initial_y,<span class="CYF"></span> <span class="string"></span>
                layer = "") returns <span class="userdata">bullet</span> [E/M/P/W]</span>
                Same as <span class="term">CreateProjectile</span>, but the bullet's spawn position is relative to the bottom
                left of the screen instead of the arena's center. The hitbox of the bullet is a rectangle around the sprite,
                unless you use CYF's PP mode.<br>
                <span class="CYF"></span> You can specify a layer if you want - otherwise, the bullet will be in the normal
                bullet layer.
            </p><br><br>

            <p>
                <span class="function">The Bullet object</span>
                This is what you use to move around the arena and store values in. You can store a bunch of bullets in a table
                and modify them. The functions and variables you can use on a Bullet are as follows.
            </p>

            <hr>
            <p>
                <span class="function"><span class="userdata">sprite</span> <span class="term">Bullet.sprite</span></span>
				the Bullet's sprite component. See the
                <span class="ref">Sprites &amp; Animation</span> section for usage details.
                <br><br>NOTE: In 0.2.1a, modifying the sprite does not change the bullet's hitbox yet; it's always the original
                square of the bullet when it was created.
                <br><span class="CYF"></span> But, in CYF, changing the bullet's sprite <i>does</i> modify the bullet's hitbox!
            </p><br>

            <p>
                <span class="function"><span class="number"></span> <span class="term">Bullet.x</span></span>
                (readonly) - The X position of this bullet, relative to the arena's center. A bullet at <span class="term">
                x=0</span> and <span class="term">y=0</span> will be at the center of the arena.
            </p><br>

            <p>
                <span class="function"><span class="number"></span> <span class="term">Bullet.y</span></span>
                (readonly) - The Y position of this bullet, relative to the arena's center.
            </p><br>

            <p>
                <span class="function"><span class="number"></span> <span class="term">Bullet.absx</span></span>
                (readonly) - The X position of this bullet, relative to the bottom left corner of the
                screen.
            </p><br>

            <p>
                <span class="function"><span class="number"></span> <span class="term">Bullet.absy</span></span>
                (readonly) - The Y position of this bullet, relative to the bottom left corner of the
                screen.
            </p><br>

            <p>
                <span class="function"><span class="CYF"></span> <span class="boolean"></span> <span class="term">
                Bullet.ppcollision</span></span>
				Whether the bullet uses Pixel-Perfect collision. If this is true, the bullet will use the Pixel-Perfect
                Collision system. I highly recommend for you to see the <span class="ref">Pixel-Perfect Collision System
                </span> section if you want to use this.
            </p><br>

            <p>
                <span class="function"><span class="CYF"></span> <span class="boolean"></span> <span class="term">
                Bullet.ppchanged</span></span>
				Determines if the collision system of the bullet has been set. True if it was, false otherwise.
            </p><br>

            <p>
                <span class="function"><span class="CYK"></span> <span class="number"></span> <span class="term">
                Bullet["from"]</span></span>
                Number ID of the active enemy who is currently handling this bullet. Any computing of the damage dealt to the
                Players on hit will use this enemy's stats.
                <br><br>
                This value will be between 1 and the max number of active enemies. If you're not sure, check out
                <span class="term">Entity.ID</span> in the <span class="ref">Entity Object</span> page.<br><br>
                This value is overridden by <span class="term">Bullet["target"]</span> if it's set.
            </p><br>

            <p>
                <span class="function"><span class="CYK"></span> <span class="number"></span> <span class="term">
                Bullet["target"]</span></span>
                Number ID of the active Player this bullet will damage if it's set, instead of going through the target value
                of an enemy entity using <span class="term">Bullet["from"]</span>.<br><br>
                Using the value <span class="term">0</span> will target all Players.
            </p><br>

            <p>
                <span class="function"><span class="CYK"></span> <span class="boolean"></span> <span class="term">
                Bullet["noGraze"]</span></span>
                False by default.<br>
				If set to true, this will prevent the player from gaining TP by grazing the bullet.
                <br><br>
                Useful on not harming bullets.
            </p><br>

            <p>
                <span class="function"><span class="CYK"></span> <span class="number"></span> <span class="term">
                Bullet["TPGain"]</span></span>
                <span class="term">2</span> by default.
                <br><br>
				Value added to the TP gauge when the player grazes it.<br>
                Disable TP gain with <span class="term">Bullet["noGraze"]</span>.
            </p><br>

            <!--
            <p>
                <span class="function"><span class="CYK"></span> <span class="number"></span> <span class="term">
                Bullet["grazeTime"]</span></span>
				Internal value used to reset the player's graze animation with this sprite. Do not modify it, it's only here
                to say this variable exists and shouldn't be modified.
            </p><br>

            <p>
                <span class="function"><span class="CYK"></span> <span class="boolean"></span> <span class="term">
                Bullet["grazed"]</span></span>
				Internal value used to know if a bullet has been grazed or not. Do not modify it, it's only here to say this
                variable exists and shouldn't be modified.
            </p><br>
            -->

            <p>
                <span class="function"><span class="boolean"></span> <span class="term">Bullet.isactive</span></span>
                (readonly) - Checks if the bullet is still active. If the bullet has been removed, this will be false;
                otherwise, it will be true.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.Move(<span class="number"></span> x, <span class="number">
                </span> y)</span></span>
				Move this bullet <span class="term">x</span> pixels to the right and <span class="term">y</span> pixels up.
                A negative <span class="term">x</span> will move it to the left, and a negative <span class="term">y</span>
                will move it downwards.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.MoveTo(<span class="number"></span> x, <span class="number">
                </span> y)</span></span>
				Move this bullet to this position immediately, relative to the arena's center.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.MoveToAbs(<span class="number"></span> x, <span class="number">
                </span> y)</span></span>
				Move this bullet to this position immediately, relative to the bottom left corner of the screen.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.Remove()</span></span>
				Destroys this bullet. You can continue retrieving its <span class="term">x</span>, <span class="term">y</span>,
                <span class="term">absx</span> and <span class="term">absy</span> properties. Trying to move a removed bullet
                will give you a Lua error. If you're not sure if your bullet still exists, check <span class="term">
                Bullet.isactive</span> first.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.SetVar(<span class="string"></span> your_variable_name, value)
                </span> or <span class="CYF"></span> <span class="term">Bullet[<span class="string"></span> your_variable_name] =
                value</span></span>
				Set a variable on this bullet that you can retrieve with <span class="term">Bullet.GetVar(<span class="string">
                </span> your_variable_name)</span>. Similar in use to <span class="term">SetGlobal()</span></span> but you can
                use this to store specific variables on a per-bullet basis.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.GetVar(<span class="string"></span> your_variable_name)</span>
                or <span class="CYF"></span> <span class="term">Bullet[<span class="string"></span> your_variable_name]</span>
                </span>
				Get a variable that you previously set using <span class="term">Bullet.SetVar()</span>.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.SendToTop()</span></span>
				Moves this bullet on top of all currently existing projectiles. Note that newly spawned projectiles are always on
                top by default; this function is mostly to move existing bullets to the top.
            </p><br>

            <p>
                <span class="function"><span class="term">Bullet.SendToBottom()</span></span>
				Moves this bullet below all currently existing projectiles.
            </p><br>

            <p>
                <span class="function"><span class="CYF"></span> <span class="term">Bullet.ResetCollisionSystem()</span></span>
				Resets the collision system of the bullet to the default one.
            </p><br>

            <p>
                <span class="function"><span class="CYF"></span> <span class="boolean"></span> <span class="term">
                Bullet.isColliding()</span></span>
				Returns true if the player is colliding with the bullet. Will use PP (pixel-perfect collisions) if the bullet has
                PP enabled.
            </p><br>

            <p>
                Here is an example of a bullet that chases you pretty fast, but slows down as it gets closer. You have to
                keep moving to dodge it. This is a fairly basic example that makes use of the Player object.
            </p>

            <div class="code-container">
<pre class="brush: lua;">oursprite = "hOI!!!!"
--Create a new bullet, starting in the upper right corner.
chasingbullet = CreateProjectile(oursprite, Arena.width/2, Arena.height/2)
--Set initial speed of 0 in both directions.
chasingbullet.SetVar('xspeed', 0)
chasingbullet.SetVar('yspeed', 0)

function Update()
    -- Get the x/y difference between the player and bullet
    local xdifference = Player.x - chasingbullet.x
    local ydifference = Player.y - chasingbullet.y
    -- We create a new speed by first halving the original speed
    -- Then we add a small fraction of the position difference between the player and bullet.
    -- The result is a bullet that moves faster as it's further away, and slower when it's closer.
    -- The value we're dividing by is experimental. Experimenting with numbers is essential!
    local xspeed = chasingbullet.GetVar('xspeed') / 2 + xdifference / 100
    local yspeed = chasingbullet.GetVar('yspeed') / 2 + ydifference / 100
    -- Now move the bullet...
    chasingbullet.Move(xspeed, yspeed)
    -- ...and store our new speeds.
    chasingbullet.SetVar('xspeed', xspeed)
    chasingbullet.SetVar('yspeed', yspeed)
end
</pre>
            </div>

            <p>
                Below is an example of a fully scripted Wave using most of these functions. It will spawn a projectile
                above the arena (assuming a width/height of 155/130), give it a random speed in the X direction, and
                drop it downwards. If it hits the bottom border of the arena, it'll bounce back up. Otherwise it'll
                continue falling off the screen.
            </p>

            <div class="code-container">
<pre class="brush: lua;">spawntimer = 0
bullets = {}

-- This happens every frame while you're defending. --
function Update()
    spawntimer = spawntimer + 1 --Add 1 to the counter every frame

    -- This part takes care of bullet spawning. --
    if spawntimer%30 == 0 then  --This happens every 30 frames.
        local posx = 30 - math.random(60) --Set a random X position between -30 and 30
        local posy = 65 --and set the Y position to 65, on the top edge of the arena.
        local bullet = CreateProjectile('hOI!!!!', posx, posy) -- Create projectile with sprite hOI!!!!.png
        bullet.SetVar('velx', 1 - 2*math.random()) -- We'll use this for horizontal speed. Random between -1/1
        bullet.SetVar('vely', 0) -- We'll use this for fall speed. We're starting without downward movement.
        table.insert(bullets, bullet) -- Add this new Bullet object to the bullets table up there.
    end

    -- This part updates every bullet in the bullets table. --
    for i=1,#bullets do -- #bullets in Lua means 'length of bullets table'.
        local bullet = bullets[i] -- For convenience, so we don't have to use bullets[i]
        local velx = bullet.GetVar('velx') -- Get the X/Y velocity we just set
        local vely = bullet.GetVar('vely')
        local newposx = bullet.x + velx -- New position will be old position + velocity
        local newposy = bullet.y + vely
        if(bullet.x &gt; -Arena.width/2 and bullet.x &lt; Arena.width/2) then -- Are we inside the arena (horizontally)?
            if(bullet.y &lt; -Arena.height/2 + 8) then -- And did we go past the bottom edge?
                bullet.MoveTo(bullet.x, -Arena.height/2 + 8) -- Don't move it past the edge!
                -- Note the +8; I know the bullet sprite I'm using is 16x16.
                -- Without adding 8 it'll be inside the edge.
                vely = 4 --reverse bounce direction
            end
        end
        vely = vely - 0.04 -- Apply gravity
        bullet.MoveTo(newposx, newposy) -- and finally, move our bullet
        bullet.SetVar('vely', vely) -- and store our new fall speed into the bullet again.
    end
end </pre>
            </div><br>

            <p>
                <span class="function">OnHit(<span class="userdata">bullet</span> bullet)</span>
                <h4>Main page is in <span class="ref">Game Events</span>.</h4>
                Every time a bullet collides with a player, this function gets called from the script that created the
                projectile. The bullet object in this function can be modified if you feel like it. For more information
                on the bullet object, see the section <span class="ref">Projectile Management</span>.
                <br>
                <br>
                If you implement this function in your script, you have to manually define what should happen after
                bullet collision. This is what allows you to create orange, cyan and green projectiles, and much much
                more. If you don't implement this function in your wave script, it'll stick to the default of dealing 3
                damage on hit.
                <br><br>
                <h4><span class="CYK"></span> IMPORTANT!</h4>
                Instead of using
                <span class="term">Player.Hurt()</span> or <span class="term">Player.Heal()</span> to change the
                Player's HP, you need to return two values:<br>
                <ol>
                    <li><span class="number"></span> OR <span class="string"></span>: The amount of damage to deal.<br>
                    If this number is negative, the player will be healed instead of hurt.
                    <br><br>
                    As a number: This will set the amount of damage the target player takes.<br>
                    As a string: This will use Deltarune's damage formula to calculate the damage you take.<br>
                    <span class="term">"100%"</span> means 100% of the calculated damage, <span class="term">"200%"</span>
                    means 200%, <span class="term">"50%"</span> means 50%, and so on.
                    <br><br>
                    You can also use negative values such as <span class="term">"-50%"</span>.</li><br>
                    <li>Optional <span class="number"></span>: The amount of seconds of invincibility.<br>
                    This is 1.7 by default, but if your bullet deals a negative amount of damage (heals the player),
                    this number will be 0.
                    </li>
                </ol>
                <br><br>
                Here are some examples:
                <br><br>
                <div class="code-container">
  <pre class="brush:lua;">function OnHit(bullet)
    return 3, 2.5 -- equal to Player.Hurt(3, 2.5) in CYF
    return 1, 0   -- equal to Player.Hurt(1, 0)   in CYF
    return -10    -- equal to Player.Heal(10)     in CYF
    return "100%" -- default value, uses enemy's ATK and player's DEF to calculate damage
    return "50%"   -- only take 50% of calculated damage
end
</pre>
                </div>
            </p>
        </div>

		<div class="tab-pane text-style" id="mercy">
            <h2 style="text-decoration: none; line-height:50px;">
                * YOU WON!<br>
                * You earned 0 EXP and 0 gold.<br>
                * also the nav menu is broken now
            </h2><br>
        </div>
	</div>
</div>

<div class="container">
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/fightbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/actbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/itembt_0.png" height="42">
    </div>
    <div class="col-xs-3"><a href="#mercy" data-toggle="tab"><img class="centerbt black" alt="Undertale fake button"
                                                                  src="../img/mercybt_0.png" height="42"></a>
    </div>
</div>
<br>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/show_hide_comments.js"></script>

<script type="text/javascript" src="../js/FontToggleButton.js"></script>
</body>
</html>